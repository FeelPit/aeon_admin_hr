# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è CORS –∏ –≤–Ω–µ—à–Ω–∏–π API - –ó–ê–í–ï–†–®–ï–ù–û

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ **405 Method Not Allowed** –∏ –ø—Ä–æ–±–ª–µ–º—ã —Å CORS –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –≤–Ω–µ—à–Ω–∏—Ö —Å–∞–π—Ç–æ–≤.

## üõ†Ô∏è –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS

**–§–∞–π–ª:** `backend/main.py`

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –º–µ—Ç–æ–¥—ã:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",
        "http://127.0.0.1:3000", 
        "http://localhost:3001",
        "http://127.0.0.1:3001",
        "http://localhost:8000",
        "http://127.0.0.1:8000",
        "http://localhost:8001",
        "http://127.0.0.1:8001",
        "https://localhost:3000",
        "https://127.0.0.1:3000",
        "https://localhost:3001", 
        "https://127.0.0.1:3001",
        "https://localhost:8000",
        "https://127.0.0.1:8000",
        "https://localhost:8001",
        "https://127.0.0.1:8001",
        "http://0.0.0.0:3000",
        "http://0.0.0.0:3001",
        "http://0.0.0.0:8000",
        "http://0.0.0.0:8001",
        "https://0.0.0.0:3000",
        "https://0.0.0.0:3001", 
        "https://0.0.0.0:8000",
        "https://0.0.0.0:8001",
        "*"  # –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
    ],
    allow_credentials=True,
    allow_methods=[
        "GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS", "HEAD"
    ],
    allow_headers=[
        "Accept", "Content-Type", "Authorization", "X-Requested-With", 
        "Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers",
        "Cache-Control", "Pragma", "Expires", "X-CSRF-Token", "X-API-Key",
        "X-Client-Version", "User-Agent", "Referer", "DNT", "Accept-Encoding",
        "Accept-Charset", "Connection", "Host", "Upgrade-Insecure-Requests",
        "Sec-Fetch-Dest", "Sec-Fetch-Mode", "Sec-Fetch-Site", "Sec-Fetch-User",
        "*"  # –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
    ],
    expose_headers=[...],
    max_age=86400,  # 24 —á–∞—Å–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è preflight –∑–∞–ø—Ä–æ—Å–æ–≤
)
```

### 2. –°–æ–∑–¥–∞–Ω –≤–Ω–µ—à–Ω–∏–π API

**–§–∞–π–ª:** `backend/app/routers/external_api.py`

–ù–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∞–π—Ç–∞–º–∏:

#### Endpoints:
- `POST /api/external/submit-results` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Ç–µ—Ä–≤—å—é
- `GET /api/external/results/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `GET /api/external/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API
- `OPTIONS /api/external/*` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ preflight –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. –¢–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–§–∞–π–ª:** `backend/static/test-external-api.html`

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ API:
- –§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ API
- –û—Ç–ª–∞–¥–∫–∞ CORS –ø—Ä–æ–±–ª–µ–º

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ endpoints

**–§–∞–π–ª:** `backend/app/routers/candidates.py`

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ endpoints:
- `POST /api/candidates/results` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `GET /api/candidates/results/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 5. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ OPTIONS

**–§–∞–π–ª:** `backend/main.py`

–î–æ–±–∞–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ OPTIONS –∑–∞–ø—Ä–æ—Å–æ–≤:
```python
@app.options("/{full_path:path}")
async def options_handler(full_path: str):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ OPTIONS –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è CORS preflight"""
    return {"message": "OK"}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API:**
```bash
curl http://localhost:8001/api/external/health
# –û—Ç–≤–µ—Ç: {"status":"healthy","service":"external-api","timestamp":"..."}
```

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```bash
curl -X POST http://localhost:8001/api/external/submit-results \
  -H "Content-Type: application/json" \
  -d '{"full_name": "–¢–µ—Å—Ç–æ–≤—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç", "results": "–¢–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"}'
# –û—Ç–≤–µ—Ç: {"success":true,"message":"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ—Ä–≤—å—é —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã","candidate_id":1,"timestamp":"..."}
```

3. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```bash
curl http://localhost:8001/api/external/results/1
# –û—Ç–≤–µ—Ç: {"id":1,"full_name":"–¢–µ—Å—Ç–æ–≤—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç","results":"–¢–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ—Ä–≤—å—é","status":"–æ–∂–∏–¥–∞–µ—Ç","created_at":"..."}
```

## üìã –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `EXTERNAL_API_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤–Ω–µ—à–Ω–µ–º—É API
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –Ω–∞ JavaScript, Python, cURL
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –æ—Ç–ª–∞–¥–∫–µ

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ CORS —Ä–µ—à–µ–Ω–∞** - –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
‚úÖ **–û—à–∏–±–∫–∞ 405 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ HTTP –º–µ—Ç–æ–¥—ã
‚úÖ **–í–Ω–µ—à–Ω–∏–π API —Ä–∞–±–æ—Ç–∞–µ—Ç** - –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ª—é–±—ã—Ö —Å–∞–π—Ç–æ–≤
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∞–π—Ç–æ–≤:

```javascript
// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞
async function submitResults(data) {
  const response = await fetch('http://localhost:8001/api/external/submit-results', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    },
    body: JSON.stringify({
      full_name: data.fullName,
      telegram_username: data.telegramUsername,
      results: data.results
    })
  });
  
  return response.json();
}
```

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:8001/test-external-api`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É
3. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∞–π—Ç–∞–º–∏!** üéâ 