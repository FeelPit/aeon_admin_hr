<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Debug - User Status</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Debug - User Status</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        // Проверяем localStorage
        const savedToken = localStorage.getItem('access_token');
        const savedUser = localStorage.getItem('user');
        
        output.innerHTML += '<h2>LocalStorage Data:</h2>';
        output.innerHTML += `<p><strong>Token:</strong> ${savedToken ? 'Present' : 'Not found'}</p>`;
        output.innerHTML += `<p><strong>User:</strong> ${savedUser ? 'Present' : 'Not found'}</p>`;
        
        if (savedUser) {
            try {
                const userData = JSON.parse(savedUser);
                output.innerHTML += '<h3>User Data:</h3>';
                output.innerHTML += `<pre>${JSON.stringify(userData, null, 2)}</pre>`;
                output.innerHTML += `<p><strong>Is Admin:</strong> ${userData.is_admin ? 'Yes' : 'No'}</p>`;
            } catch (e) {
                output.innerHTML += `<p>Error parsing user data: ${e.message}</p>`;
            }
        }
        
        // Проверяем Telegram WebApp
        output.innerHTML += '<h2>Telegram WebApp:</h2>';
        if (window.Telegram && window.Telegram.WebApp) {
            output.innerHTML += '<p>✅ Telegram WebApp доступен</p>';
            output.innerHTML += `<p><strong>Init Data:</strong> ${window.Telegram.WebApp.initData || 'Empty'}</p>`;
            output.innerHTML += `<p><strong>User:</strong> ${JSON.stringify(window.Telegram.WebApp.initDataUnsafe?.user || 'Not available')}</p>`;
        } else {
            output.innerHTML += '<p>❌ Telegram WebApp недоступен</p>';
        }
        
        // Тестируем API
        output.innerHTML += '<h2>API Test:</h2>';
        if (savedToken) {
            fetch('/api/telegram/profile', {
                headers: {
                    Authorization: `Bearer ${savedToken}`,
                },
            })
            .then(response => response.json())
            .then(data => {
                output.innerHTML += '<p>✅ Profile API Response:</p>';
                output.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            })
            .catch(error => {
                output.innerHTML += `<p>❌ Profile API Error: ${error.message}</p>`;
            });
        } else {
            output.innerHTML += '<p>❌ No token available for API test</p>';
        }
    </script>
</body>
</html> 